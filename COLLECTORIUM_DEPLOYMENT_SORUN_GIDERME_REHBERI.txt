# ğŸš¨ COLLECTORIUM DEPLOYMENT SORUN GÄ°DERME REHBERÄ°
# ============================================================================
# Tarih: 23 Ekim 2025
# Proje: Collectorium cPanel Deployment
# Durum: DNS Propagation Bekleniyor
# ============================================================================

## ğŸ“Š MEVCUT DURUM Ã–ZETÄ°

### âœ… BAÅARILI KONFIGÃœRASYONLAR
- **Django Application**: âœ… Ã‡alÄ±ÅŸÄ±yor
- **Database**: âœ… SQLite baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±
- **Dependencies**: âœ… TÃ¼m paketler yÃ¼klendi
- **Static Files**: âœ… WhiteNoise konfigÃ¼rasyonu
- **Security**: âœ… Production settings aktif
- **Environment Variables**: âœ… DoÄŸru ayarlandÄ±

### âš ï¸ MEVCUT SORUN: DNS PROPAGATION
**Sorun**: Domain hala eski IP adresine Ã§Ã¶zÃ¼mleniyor
- **Mevcut IP**: 93.89.230.125 (eski)
- **Hedef IP**: 45.151.250.159 (cPanel)
- **Durum**: DNS propagation bekleniyor (1-12 saat)

## ğŸ” SORUN TESPÄ°T VE Ã‡Ã–ZÃœM REHBERÄ°

### 1. DNS PROPAGATION SORUNLARI

#### Sorun: Domain eski IP'ye Ã§Ã¶zÃ¼mleniyor
**Belirtiler:**
- `whatsmydns.net` sonuÃ§larÄ± eski IP gÃ¶steriyor
- Site eriÅŸilemiyor
- SSL sertifikasÄ± oluÅŸturulamÄ±yor

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **DNS KayÄ±tlarÄ±nÄ± Kontrol Et**
   ```bash
   # cPanel â†’ Zone Editor
   A Record: collectorium.com.tr â†’ 45.151.250.159
   CNAME: www.collectorium.com.tr â†’ collectorium.com.tr
   TTL: 300 (5 dakika)
   ```

2. **DNS Propagation Bekle**
   - **Beklenen sÃ¼re**: 1-12 saat
   - **Kontrol**: whatsmydns.net ile periyodik kontrol
   - **TÃ¼m DNS sunucularÄ±nda yayÄ±ldÄ±ÄŸÄ±nÄ± doÄŸrula**

3. **SSL SertifikasÄ± OluÅŸtur**
   ```bash
   # DNS yayÄ±ldÄ±ktan sonra
   cPanel â†’ SSL/TLS â†’ "Run AutoSSL"
   "Force HTTPS Redirect" aktif et
   ```

#### Sorun: DNS propagation Ã§ok uzun sÃ¼rÃ¼yor
**Ã‡Ã¶zÃ¼m:**
1. **TTL DeÄŸerini DÃ¼ÅŸÃ¼r**
   ```bash
   # Zone Editor'de TTL'i 300'e dÃ¼ÅŸÃ¼r
   # 48 saat bekle (eski TTL'in expire olmasÄ± iÃ§in)
   ```

2. **DNS Cache Temizle**
   ```bash
   # cPanel'de
   Zone Editor â†’ "Clear Cache" â†’ "Reload"
   ```

3. **Nameserver Kontrol Et**
   ```bash
   # Domain saÄŸlayÄ±cÄ±nÄ±zda
   ns1.veridyen.com
   ns2.veridyen.com
   ```

### 2. DJANGO APPLICATION SORUNLARI

#### Sorun: Application baÅŸlamÄ±yor
**Belirtiler:**
- 503 Service Unavailable
- "Application failed to start"
- Passenger error logs

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Passenger Error Logs Kontrol Et**
   ```bash
   # cPanel â†’ Python App â†’ Logs
   # Hata mesajlarÄ±nÄ± incele
   ```

2. **Dependencies Kontrol Et**
   ```bash
   cd ~/collectorium
   source ~/virtualenv/collectorium/bin/activate
   pip install -r requirements.txt --force-reinstall
   ```

3. **Environment Variables Kontrol Et**
   ```bash
   # cPanel â†’ Python App â†’ Environment
   DJANGO_SETTINGS_MODULE=collectorium.settings.hosting
   SECRET_KEY=your-secret-key
   DEBUG=False
   ALLOWED_HOSTS=collectorium.com.tr,www.collectorium.com.tr
   ```

4. **Django Settings Test Et**
   ```bash
   python manage.py check
   python manage.py check --deploy
   ```

5. **Application Restart**
   ```bash
   touch tmp/restart.txt
   ```

#### Sorun: Database connection failed
**Belirtiler:**
- 500 Internal Server Error
- "database connection failed"
- Database error logs

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Database Connection Test**
   ```bash
   python scripts/test_db_connection.py
   ```

2. **Environment Variables Kontrol Et**
   ```bash
   # SQLite iÃ§in (ÅŸu anki durum)
   # PostgreSQL iÃ§in
   DATABASE_URL=postgresql://user:pass@host:port/dbname
   # MySQL iÃ§in
   DATABASE_URL=mysql://user:pass@localhost:3306/dbname
   ```

3. **Database Service Kontrol Et**
   ```bash
   # PostgreSQL (external)
   psql -h hostname -U username -d database_name -c "SELECT 1"
   
   # MySQL (cPanel)
   mysql -h localhost -u username -p -e "SELECT 1"
   ```

4. **Firewall Kontrol Et**
   ```bash
   # External PostgreSQL iÃ§in
   # cPanel server IP'sinin database host'a eriÅŸimi
   ```

#### Sorun: Static files yÃ¼klenmiyor
**Belirtiler:**
- CSS/JS dosyalarÄ± 404
- GÃ¶rsel dosyalar yÃ¼klenmiyor
- Admin panel stilleri bozuk

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Static Files Collect**
   ```bash
   python manage.py collectstatic --noinput --clear
   ```

2. **Permissions Kontrol Et**
   ```bash
   chmod -R 755 ~/public/static
   chmod -R 755 ~/public/media
   ```

3. **WhiteNoise Kontrol Et**
   ```bash
   # settings.py'de
   STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
   ```

4. **Static Files Test Et**
   ```bash
   curl -I https://yourdomain.com/static/admin/css/base.css
   # 200 OK dÃ¶nmeli
   ```

### 3. SSL/HTTPS SORUNLARI

#### Sorun: SSL sertifikasÄ± oluÅŸturulamÄ±yor
**Belirtiler:**
- "AutoSSL is not currently active"
- "SSL certificate is not valid"
- HTTPS redirect Ã§alÄ±ÅŸmÄ±yor

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **DNS Propagation Bekle**
   ```bash
   # whatsmydns.net ile kontrol et
   # TÃ¼m DNS sunucularÄ±nda yayÄ±ldÄ±ÄŸÄ±nÄ± doÄŸrula
   ```

2. **AutoSSL Aktif Et**
   ```bash
   cPanel â†’ SSL/TLS â†’ "Run AutoSSL"
   ```

3. **SSL Certificate Kontrol Et**
   ```bash
   cPanel â†’ SSL/TLS â†’ "Manage SSL Sites"
   # Certificate status: Active
   ```

4. **HTTPS Redirect Aktif Et**
   ```bash
   cPanel â†’ SSL/TLS â†’ "Force HTTPS Redirect"
   ```

#### Sorun: Mixed content warnings
**Belirtiler:**
- HTTPS sayfada HTTP resources
- Browser security warnings
- Mixed content errors

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Settings Kontrol Et**
   ```python
   SECURE_SSL_REDIRECT = True
   SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
   ```

2. **Template Kontrol Et**
   ```html
   <!-- HTTP yerine HTTPS kullan -->
   <link rel="stylesheet" href="https://cdn.example.com/style.css">
   ```

### 4. EMAIL SORUNLARI

#### Sorun: Email gÃ¶nderilmiyor
**Belirtiler:**
- Password reset emails gelmiyor
- Contact form emails gÃ¶nderilmiyor
- SMTP connection errors

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Email Configuration Test**
   ```bash
   python scripts/test_email.py your-email@example.com
   ```

2. **SMTP Settings Kontrol Et**
   ```bash
   EMAIL_HOST=smtp.gmail.com
   EMAIL_PORT=587
   EMAIL_USE_TLS=True
   EMAIL_HOST_USER=your-email@gmail.com
   EMAIL_HOST_PASSWORD=your-app-password
   ```

3. **Gmail App Password Kullan**
   ```bash
   # Gmail â†’ Security â†’ 2-Step Verification â†’ App passwords
   # Normal password deÄŸil, app password kullan
   ```

4. **cPanel Email Kullan**
   ```bash
   EMAIL_HOST=localhost
   EMAIL_PORT=587
   EMAIL_HOST_USER=your-cpanel-email@yourdomain.com
   EMAIL_HOST_PASSWORD=your-cpanel-password
   ```

### 5. GOOGLE OAUTH SORUNLARI

#### Sorun: Google OAuth Ã§alÄ±ÅŸmÄ±yor
**Belirtiler:**
- "Sign in with Google" butonu Ã§alÄ±ÅŸmÄ±yor
- redirect_uri_mismatch hatasÄ±
- OAuth callback errors

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Google Cloud Console Kontrol Et**
   ```bash
   # Authorized redirect URIs
   https://collectorium.com.tr/accounts/google/login/callback/
   https://www.collectorium.com.tr/accounts/google/login/callback/
   ```

2. **Django Admin Kontrol Et**
   ```bash
   # /admin/ â†’ Sites â†’ collectorium.com.tr
   # /admin/ â†’ Social Applications â†’ Google
   # Client ID ve Secret doÄŸru mu?
   ```

3. **Environment Variables Kontrol Et**
   ```bash
   GOOGLE_OAUTH_CLIENT_ID=your-client-id
   GOOGLE_OAUTH_CLIENT_SECRET=your-client-secret
   ```

4. **OAuth Flow Test Et**
   ```bash
   # /accounts/login/ â†’ "Sign in with Google"
   # Complete authentication
   # Verify successful login
   ```

### 6. PERFORMANCE SORUNLARI

#### Sorun: Site yavaÅŸ yÃ¼kleniyor
**Belirtiler:**
- Sayfa yÃ¼kleme sÃ¼resi > 3 saniye
- Database query timeout
- Memory usage yÃ¼ksek

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Database Query Optimization**
   ```python
   # select_related() ve prefetch_related() kullan
   listings = Listing.objects.select_related('store', 'product').prefetch_related('images')
   ```

2. **Cache Configuration**
   ```python
   # Redis cache aktif et (eÄŸer mevcut)
   REDIS_URL=redis://localhost:6379/0
   ```

3. **Static Files Optimization**
   ```bash
   # WhiteNoise compression zaten aktif
   # CDN kullanÄ±mÄ± dÃ¼ÅŸÃ¼n
   ```

4. **Database Connection Pooling**
   ```python
   CONN_MAX_AGE = 600  # 10 minutes
   ```

#### Sorun: Memory usage yÃ¼ksek
**Belirtiler:**
- Application slow
- 503 errors
- "out of memory" errors

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Application Restart**
   ```bash
   touch tmp/restart.txt
   ```

2. **Log Level Kontrol Et**
   ```python
   # LOG_LEVEL=INFO (DEBUG deÄŸil)
   ```

3. **Memory Leaks Kontrol Et**
   ```bash
   # Custom code'da memory leak var mÄ±?
   # Database connection'lar kapatÄ±lÄ±yor mu?
   ```

### 7. LOGGING VE MONÄ°TORÄ°NG SORUNLARI

#### Sorun: Logs gÃ¶rÃ¼nmÃ¼yor
**Belirtiler:**
- Error logs boÅŸ
- Application logs yok
- Debugging zor

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Log Directory Kontrol Et**
   ```bash
   ls -la ~/logs/
   # django.log ve error.log var mÄ±?
   ```

2. **Log Permissions Kontrol Et**
   ```bash
   chmod 644 ~/logs/*.log
   ```

3. **Log Rotation Kontrol Et**
   ```bash
   # Log files Ã§ok bÃ¼yÃ¼k mÃ¼?
   # Rotation Ã§alÄ±ÅŸÄ±yor mu?
   ```

4. **Real-time Log Monitoring**
   ```bash
   tail -f ~/logs/django.log
   tail -f ~/logs/error.log
   ```

#### Sorun: Health check Ã§alÄ±ÅŸmÄ±yor
**Belirtiler:**
- /healthz/ endpoint 404
- Monitoring systems Ã§alÄ±ÅŸmÄ±yor
- Uptime monitoring failed

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Health Check Test Et**
   ```bash
   curl -s https://yourdomain.com/healthz/ | jq
   # {"status": "healthy"} dÃ¶nmeli
   ```

2. **URL Configuration Kontrol Et**
   ```python
   # core/urls.py
   path('healthz/', health_check, name='health_check'),
   ```

3. **Health Check View Kontrol Et**
   ```python
   # core/health.py
   def health_check(request):
       return JsonResponse({'status': 'healthy'})
   ```

### 8. BACKUP VE RECOVERY SORUNLARI

#### Sorun: Backup Ã§alÄ±ÅŸmÄ±yor
**Belirtiler:**
- Cron job Ã§alÄ±ÅŸmÄ±yor
- Backup files oluÅŸmuyor
- Database backup failed

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Cron Job Kontrol Et**
   ```bash
   # cPanel â†’ Cron Jobs
   0 2 * * * cd ~/collectorium && source ~/virtualenv/collectorium/bin/activate && python scripts/backup_database.py
   ```

2. **Backup Script Test Et**
   ```bash
   python scripts/backup_database.py
   # Manual test
   ```

3. **Backup Directory Kontrol Et**
   ```bash
   ls -la ~/backups/
   # Backup files var mÄ±?
   ```

4. **Permissions Kontrol Et**
   ```bash
   chmod +x scripts/backup_database.py
   ```

#### Sorun: Restore Ã§alÄ±ÅŸmÄ±yor
**Belirtiler:**
- Database restore failed
- Data corruption
- Restore process errors

**Ã‡Ã¶zÃ¼m AdÄ±mlarÄ±:**
1. **Backup File Kontrol Et**
   ```bash
   # Backup file exists and readable?
   ls -la ~/backups/collectorium_*.sql.gz
   ```

2. **Database Connection Kontrol Et**
   ```bash
   # Restore sÄ±rasÄ±nda database accessible?
   ```

3. **Restore Process Test Et**
   ```bash
   # Manual restore test
   gunzip ~/backups/collectorium_YYYYMMDD.sql.gz
   psql -h hostname -U username -d database_name < ~/backups/collectorium_YYYYMMDD.sql
   ```

## ğŸš¨ ACÄ°L DURUM PROSEDÃœRLERÄ°

### 1. SÄ°TE TAMAMEN DOWN
**HÄ±zlÄ± Ã‡Ã¶zÃ¼m:**
1. **Application Restart**
   ```bash
   touch tmp/restart.txt
   ```

2. **Health Check**
   ```bash
   curl -I https://yourdomain.com/healthz/
   ```

3. **Logs Kontrol Et**
   ```bash
   tail -50 ~/logs/error.log
   ```

4. **Rollback (gerekirse)**
   ```bash
   # DNS'i eski IP'ye geri Ã§evir
   # Render environment'a geri dÃ¶n
   ```

### 2. DATABASE CORRUPTION
**HÄ±zlÄ± Ã‡Ã¶zÃ¼m:**
1. **Database Connection Test**
   ```bash
   python scripts/test_db_connection.py
   ```

2. **Latest Backup Restore**
   ```bash
   # En son backup'Ä± restore et
   ```

3. **Data Integrity Check**
   ```bash
   # Database integrity kontrol et
   ```

### 3. SECURITY BREACH
**HÄ±zlÄ± Ã‡Ã¶zÃ¼m:**
1. **Application Stop**
   ```bash
   # Emergency stop
   ```

2. **Security Audit**
   ```bash
   # Logs kontrol et
   # Suspicious activity var mÄ±?
   ```

3. **Password Reset**
   ```bash
   # TÃ¼m admin passwords reset
   ```

## ğŸ“ DESTEK KAYNAKLARI

### ğŸ”§ Teknik Destek
- **cPanel Support**: Veridyen teknik destek
- **DNS Provider**: Domain registrar
- **Database Provider**: (eÄŸer external)
- **Development Team**: Proje ekibi

### ğŸ“š DokÃ¼mantasyon
- **Migration Guide**: `docs/MIGRATION_TO_CPANEL.md`
- **Operations Runbook**: `RUNBOOK_CPANEL.md`
- **Deployment Checklist**: `migrate_logs/MIGRATION_COMPLETE.md`
- **Environment Template**: `env.hosting.example`

### ğŸ§ª Test Scripts
- **Database Test**: `scripts/test_db_connection.py`
- **Email Test**: `scripts/test_email.py`
- **Backup Script**: `scripts/backup_database.py`
- **Smoke Test**: `scripts/smoke_test.py`

### ğŸ“Š Monitoring Tools
- **whatsmydns.net**: DNS propagation kontrol
- **dnschecker.org**: DNS propagation kontrol
- **UptimeRobot**: Uptime monitoring
- **Sentry**: Error tracking

## ğŸ¯ SONUÃ‡

**Collectorium projesi teknik olarak hazÄ±r durumda. Mevcut sorun sadece DNS propagation bekleniyor. TÃ¼m Ã§Ã¶zÃ¼m adÄ±mlarÄ± yukarÄ±da detaylandÄ±rÄ±lmÄ±ÅŸ.**

**Ã–ncelik sÄ±rasÄ±:**
1. â° DNS propagation bekle (1-12 saat)
2. ğŸ”’ SSL sertifikasÄ± oluÅŸtur
3. ğŸŒ Site eriÅŸimini test et
4. ğŸ“Š Monitoring kurulumu
5. ğŸ’¾ Backup stratejisi

**Proje canlÄ±ya alÄ±nmaya hazÄ±r! ğŸš€**

---
**Rehber Tarihi**: 23 Ekim 2025
**Durum**: âœ… HAZIR - DNS BEKLENÄ°YOR
**Sonraki AdÄ±m**: DNS propagation tamamlandÄ±ÄŸÄ±nda SSL kurulumu
**Tahmini CanlÄ±ya Alma**: 1-12 saat iÃ§inde
